manifest {
	mainScript = "main.nf"
	defaultBranch = "master"
	nextflowVersion = ">=0.32.0"
}

params {
	dataset = "${PWD}/data/gtex/gtex_gct_data_float_v7.npy"
	gene_list = "${PWD}/data/gtex/gtex_gene_list_v7.npy"
	sample_json = "${PWD}/data/gtex/gtex_tissue_count_v7.json"
	config = "models/net_config.json"

	subset = true
	subset_list = "${PWD}/data/subsets/hallmark_experiments.txt"

	random = true
	random_min = 1
	random_max = 10
	random_iters = 1

	chunks = 10

	output_dir = "${PWD}/output"

	execution {
		queue_size = 100
		threads = 1
		max_retries = 0
		error_strategy = "terminate"
	}
}



report {
	file = "${params.output_dir}/report.html"
}



timeline {
	file = "${params.output_dir}/timeline.html"
}



trace {
	fields = "task_id,hash,native_id,process,tag,name,status,exit,module,container,cpus,time,disk,memory,attempt,submit,start,complete,duration,realtime,queue,%cpu,%mem,rss,vmem,peak_rss,peak_vmem,rchar,wchar,syscr,syscw,read_bytes,write_bytes"
	file = "${params.output_dir}/trace.txt"
	raw = true
}



process {
	errorStrategy = { "${task.attempt}" <= "${params.execution.max_retries}" ? "retry" : "${params.execution.error_strategy}" }
	maxRetries = "${params.execution.max_retries}"
	// maxErrors = 1000
}



profiles {

	standard {
		process.executor = "local"
		executor.cpus = 1
		executor.memory = "8 GB"
	}

	pbs {
		process {
			executor = "pbs"
			time = "8h"
			clusterOptions = "-l select=1:mem=2gb:ncpus=2:ngpus=2:gpu_model=p100"
		}
		executor {
			queueSize = "${params.execution.queue_size}"
		}
	}
}
